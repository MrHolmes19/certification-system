{% extends "base.html" %}

{% load static %}

{% block content %}

<section id="pend-doc">
    <div class="container my-2">
        <div class="row">
            <div class="col-md-10 offset-md-1 col-lg-10 offset-lg-1 pt-2 pb-4">
                <h2 class="text-center mt-2 mb-5"> Sacá turno para la verificación fisica </h2>

                <p> <strong>¡ Tu pago fue registrado exitosamente !</strong> </p>
                <br>
                <p> Para continuar, debés traernos tu vehiculo modificado para realizar la verificación visual.<p>
                <form action="{% url 'Appointment' pk=operation.id %}" method="POST">
                    {% csrf_token %}

                    <input type="date" name="day" id="day">
                    <table>
                        <th>Horario</th>
                        {% for i in '012345'|make_list %}
                        <tr>

                        <td> {{ forloop.counter |add:7}}:00 <input type="radio" name="schedule" id="radio_{{ forloop.counter |add:7}}:00" value="{{ forloop.counter |add:7}}:00"></td>
                        <td> {{ forloop.counter |add:7}}:20 <input type="radio" name="schedule" id="radio_{{ forloop.counter |add:7}}:20" value="{{ forloop.counter |add:7}}:20"></td>
                        <td> {{ forloop.counter |add:7}}:40 <input type="radio" name="schedule" id="radio_{{ forloop.counter |add:7}}:40" value="{{ forloop.counter |add:7}}:40"></td>

                        </tr>
                        {% endfor %}
                    </table>
                        <button type="submit">Reservar</button>
                </form>

                </table>
             {% comment %}    <p> El siguiente botón te redireccionará al sistema de turnos.<p>
                <br>
                <div class="d-inline-flex gap-2 align-items-center">
                    <small class="text-muted"> Reservá un turno: </small> 
                    <a href="https://calendly.com/certificaciones-larroca/verificacion-fisica" class="btn btn-success" role="button">Sacar Turno</a>   
                </div>    
                <a href="https://calendly.com/certificaciones-larroca/verificacion-fisica" class="btn btn-success" role="button">Sacar Turno</a>     {% endcomment %}                    
            </div>
        </div>
    </div>

    <script>
        const mylist = JSON.parse("{{appointments_list}}".replace(/&quot;/g,'"'));
        for(i = 0; i < mylist.length; i++){
            console.log(mylist[i])
        };
        //console.log({{appointments_list}})

        const picker = document.getElementById('day');
        picker.addEventListener('input', function(e){
        var day = new Date(this.value).getUTCDay();
        if([6,0].includes(day)){
            e.preventDefault();
            this.value = '';
        }
        });

        day_input = document.getElementById('day')

        day_input.addEventListener('change', (event) => {
    
            
            block_radios(day_input.value)

    });

    function block_radios(day_value){
        all_radios = document.getElementsByName("schedule");
        all_radios.forEach(element => {
            element.removeAttribute("disabled");
        });
        console.log(day_input.value)

        for(i = 0; i < mylist.length; i++){
            try{
                element_day = mylist[i].split("T")[0];
                element_time = mylist[i].split("T")[1];
                if(element_day == day_input.value){
                    
                    time = element_time.substr(0, 5);
                    console.log("entro al if "+time);
                    if(time.charAt(0) == "0"){
                        time = time.substr(1, time.length)
                    }
                    let radio_id = "radio_" + time;
                    document.getElementById(radio_id).setAttribute("disabled", "true");
                    
            }
            }
            catch{
                a = 0;
            }

        };
    }


    </script>

</section>

{% endblock %}